{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/specification.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "indexAction",
        "model",
        "data",
        "where",
        "id",
        "select",
        "success",
        "getGoodsSpecAction",
        "post",
        "goods_id",
        "is_delete",
        "specData",
        "specification_id",
        "item",
        "goods_spec_id",
        "goods_specification_ids",
        "specValueData",
        "find",
        "value",
        "console",
        "log",
        "dataInfo",
        "specValue",
        "productUpdateAction",
        "goods_number",
        "goods_weight",
        "goods_origin",
        "this3",
        "goods_expiration",
        "goods_sn",
        "retail_price",
        "cost",
        "updateInfo",
        "update",
        "idData",
        "field",
        "goods_specification_id",
        "info",
        "pro",
        "length",
        "goodsNum",
        "sum",
        "maxPrice",
        "max",
        "minPrice",
        "min",
        "maxCost",
        "minCost",
        "goodsPrice",
        "costPrice",
        "cost_price",
        "min_retail_price",
        "min_cost_price",
        "productDeleAction",
        "productId",
        "limit",
        "delete",
        "lastData",
        "delePrimarySpecAction",
        "detailAction",
        "addAction",
        "sort",
        "name",
        "sort_order",
        "add",
        "checkSnAction",
        "sn",
        "fail",
        "updateAction",
        "deleteAction",
        "goods_spec"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/specification.js",
    "sourcesContent": [
        "const Base = require(\"./base.js\");\nmodule.exports = class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction() {\n    const model = this.model(\"specification\");\n    const data = await model\n      .where({\n        id: [\">\", 0]\n      })\n      .select();\n    return this.success(data);\n  }\n  async getGoodsSpecAction() {\n    const id = this.post(\"id\");\n    const model = this.model(\"product\");\n    const data = await model\n      .where({\n        goods_id: id,\n        is_delete: 0\n      })\n      .select();\n    //TODO 这里只有一层，以后如果有多重型号，如一件商品既有颜色又有尺寸时，这里的代码是不对的。以后再写。\n    let specData = [];\n    let specification_id = 0;\n    for (const item of data) {\n      let goods_spec_id = item.goods_specification_ids;\n      let specValueData = await this.model(\"goods_specification\")\n        .where({\n          id: goods_spec_id,\n          is_delete: 0\n        })\n        .find();\n      specification_id = specValueData.specification_id;\n      item.value = specValueData.value;\n    }\n    console.log(data);\n    let dataInfo = {\n      specData: data,\n      specValue: specification_id\n    };\n    return this.success(dataInfo);\n  }\n  async productUpdateAction() {\n    const goods_number = this.post(\"goods_number\");\n    const goods_weight = this.post(\"goods_weight\");\n    const goods_origin = this3.post(\"goods_origin\");\n    const goods_expiration = this3.post(\"goods_expiration\");\n    const goods_sn = this.post(\"goods_sn\");\n    const retail_price = this.post(\"retail_price\");\n    const cost = this.post(\"cost\");\n    const value = this.post(\"value\");\n    let updateInfo = {\n      goods_number: goods_number,\n      goods_weight: goods_weight,\n      goods_origin: goods_origin,\n      goods_expiration: goods_expiration,\n      cost: cost,\n      retail_price: retail_price\n    };\n    await this.model(\"cart\")\n      .where({\n        goods_sn: goods_sn\n      })\n      .update({\n        retail_price: retail_price\n      });\n    const model = this.model(\"product\");\n    await model\n      .where({\n        goods_sn: goods_sn\n      })\n      .update(updateInfo);\n    let idData = await model\n      .where({\n        goods_sn: goods_sn\n      })\n      .field(\"goods_specification_ids,goods_id\")\n      .find();\n    let goods_specification_id = idData.goods_specification_ids;\n    let info = await this.model(\"goods_specification\")\n      .where({\n        id: goods_specification_id\n      })\n      .update({\n        value: value\n      });\n    let goods_id = idData.goods_id;\n    // todo 价格显示为区间\n    let pro = await this.model(\"product\")\n      .where({\n        goods_id: goods_id\n      })\n      .select();\n    if (pro.length > 1) {\n      let goodsNum = await this.model(\"product\")\n        .where({\n          goods_id: goods_id\n        })\n        .sum(\"goods_number\");\n      let maxPrice = await this.model(\"product\")\n        .where({\n          goods_id: goods_id\n        })\n        .max(\"retail_price\");\n      let minPrice = await this.model(\"product\")\n        .where({\n          goods_id: goods_id\n        })\n        .min(\"retail_price\");\n      let maxCost = await this.model(\"product\")\n        .where({\n          goods_id: goods_id\n        })\n        .max(\"cost\");\n      let minCost = await this.model(\"product\")\n        .where({\n          goods_id: goods_id\n        })\n        .min(\"cost\");\n      let goodsPrice = minPrice + \"-\" + maxPrice;\n      let costPrice = minCost + \"-\" + maxCost;\n      await this.model(\"goods\")\n        .where({\n          id: goods_id\n        })\n        .update({\n          goods_number: goodsNum,\n          retail_price: goodsPrice,\n          cost_price: costPrice,\n          min_retail_price: minPrice,\n          min_cost_price: minCost\n        });\n    } else {\n      await this.model(\"goods\")\n        .where({\n          id: goods_id\n        })\n        .update({\n          goods_number: goods_number,\n          retail_price: retail_price,\n          cost_price: cost,\n          min_retail_price: retail_price,\n          min_cost_price: cost\n        });\n    }\n    return this.success(info);\n  }\n  async productDeleAction() {\n    const productId = this.post(\"id\");\n    const model = this.model(\"product\");\n    let idData = await model\n      .where({\n        id: productId\n      })\n      .field(\"goods_specification_ids,goods_id\")\n      .find();\n    let goods_specification_id = idData.goods_specification_ids;\n    let goods_id = idData.goods_id;\n    await model\n      .where({\n        id: productId\n      })\n      .limit(1)\n      .delete();\n    let info = await this.model(\"goods_specification\")\n      .where({\n        id: goods_specification_id\n      })\n      .limit(1)\n      .delete();\n    let lastData = await model\n      .where({\n        goods_id: goods_id\n      })\n      .select();\n    if (lastData.length != 0) {\n      let goodsNum = await this.model(\"product\")\n        .where({\n          goods_id: goods_id\n        })\n        .sum(\"goods_number\");\n      let goodsPrice = await this.model(\"product\")\n        .where({\n          goods_id: goods_id\n        })\n        .min(\"retail_price\");\n      await this.model(\"goods\")\n        .where({\n          id: goods_id\n        })\n        .update({\n          goods_number: goodsNum,\n          retail_price: goodsPrice\n        });\n    }\n    return this.success(info);\n  }\n  async delePrimarySpecAction() {\n    const goods_id = this.post(\"id\");\n    const model = this.model(\"product\");\n    await model\n      .where({\n        goods_id: goods_id\n      })\n      .delete();\n    let info = await this.model(\"goods_specification\")\n      .where({\n        goods_id: goods_id\n      })\n      .delete();\n    await this.model(\"goods\")\n      .where({\n        id: goods_id\n      })\n      .update({\n        goods_number: 0,\n        retail_price: 0\n      });\n    return this.success(info);\n  }\n  async detailAction() {\n    let id = this.post(\"id\");\n    let info = await this.model(\"specification\")\n      .where({\n        id: id\n      })\n      .find();\n    return this.success(info);\n  }\n  async addAction() {\n    const value = this.post(\"name\");\n    const sort = this.post(\"sort_order\");\n    let info = {\n      name: value,\n      sort_order: sort\n    };\n    const model = this.model(\"specification\");\n    const data = await model.add(info);\n    return this.success(data);\n  }\n  async checkSnAction() {\n    const sn = this.post(\"sn\");\n    const model = this.model(\"product\");\n    const data = await model\n      .where({\n        goods_sn: sn\n      })\n      .select();\n    if (data.length > 0) {\n      return this.fail(\"sn已存在\");\n    } else {\n      return this.success(data);\n    }\n  }\n  async updateAction() {\n    const id = this.post(\"id\");\n    const value = this.post(\"name\");\n    const sort = this.post(\"sort_order\");\n    let info = {\n      name: value,\n      sort_order: sort\n    };\n    const model = this.model(\"specification\");\n    const data = await model\n      .where({\n        id: id\n      })\n      .update(info);\n    return this.success(data);\n  }\n  async deleteAction() {\n    const id = this.post(\"id\");\n    const goods_spec = await this.model(\"goods_specification\")\n      .where({\n        specification_id: id,\n        is_delete: 0\n      })\n      .select();\n    console.log(goods_spec);\n    if (goods_spec.length > 0) {\n      return this.fail(\"该型号下有商品，暂不能删除\");\n    } else {\n      const model = this.model(\"specification\");\n      const data = await model\n        .where({\n          id: id\n        })\n        .limit(1)\n        .delete();\n      return this.success(data);\n    }\n  }\n};\n"
    ]
}